<script>
/* 1) Apply saved theme ASAP (avoid flash) */
(function(){
  try {
    var saved = localStorage.getItem('dg-theme');
    if (saved) document.documentElement.setAttribute('data-theme', saved);
  } catch(e){}
})();

/* 2) Inject the toggle button + styles when DOM is ready */
document.addEventListener('DOMContentLoaded', function () {
  try {
    // Create styles
    var css = document.createElement('style');
    css.textContent = `
      .theme-toggle {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        z-index: 9999;
        padding: .5rem .7rem;
        border-radius: 8px;
        border: 1px solid var(--background-modifier-border, rgba(0,0,0,.15));
        background: var(--background-secondary, rgba(255,255,255,.9));
        color: var(--text-normal, #111);
        cursor: pointer;
        font-size: .95rem;
        line-height: 1;
        box-shadow: 0 6px 20px rgba(0,0,0,.15);
        transition: background .2s ease;
      }
      .theme-toggle:hover { background: var(--background-secondary-alt, rgba(240,240,240,.95)); }
      :root[data-theme="dark"] .theme-toggle {
        background: var(--background-secondary, #1f2430);
        color: var(--text-normal, #eaeaea);
        border-color: var(--background-modifier-border, rgba(255,255,255,.15));
      }
    `;
    document.head.appendChild(css);

    // Create button
    var btn = document.createElement('button');
    btn.id = 'theme-toggle';
    btn.className = 'theme-toggle';
    var isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    btn.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';

    btn.addEventListener('click', function () {
      var root = document.documentElement;
      var dark = root.getAttribute('data-theme') === 'dark';
      var next = dark ? 'light' : 'dark';
      root.setAttribute('data-theme', next);
      try { localStorage.setItem('dg-theme', next); } catch(e){}
      btn.textContent = dark ? 'üåô' : '‚òÄÔ∏è';
    });

    document.body.appendChild(btn);
  } catch(e){
    console.warn('[DG] Theme toggle inject failed:', e);
  }
});
</script>
